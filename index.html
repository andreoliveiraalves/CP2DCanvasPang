<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>PANG_GAME</title>
    <style>
        canvas {
            /* Centrar canvas na página */
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
    </style>
</head>

<body>
    <canvas class="center" id="myCanvas" width="800" height="475" style="border:solid 1px black">
        Your browser does not support HTML5 Canvas.
    </canvas>
    <script>
        //obter contexto do canvas //
        const canvas = document.querySelector('#myCanvas');
        const ctx = canvas.getContext("2d");

        //definição de propriedades do canvas //
        const W = canvas.width,
            H = canvas.height;

        //Definição de coordenadas iniciais para o personagem //
        let charX = W / 2,
            charY = 305;


        //Carregando assets //
        let images = {};

        function loadImage(name) {
            images[name] = new Image();
            images[name].src = "./img/" + name + ".png";
            images[name].onload = function () {
                setInterval(1000 / 20);
            };
        }
        loadImage('bg');
        loadImage('charL');
        loadImage('charR');
        loadImage('tile');
        loadImage('hp');

        // Boleano de Controlo de direção //

        let movesRight = true;

        // Construção de classe para as bolas //

        class Ball {


            constructor(x, y, r, c, dx, dy) {
                this.x = x; // Coordenada em X //
                this.y = y; // Coordanada em Y //
                this.r = r; // Raio //
                this.c = c; // Cor //
                this.dx = dx; // acelaração horizontal //
                this.dy = dy; // acelalaração vertical //
                this.pop = false; // estado para controlar quando bola é rebentada //
            }
            draw() {
                ctx.fillStyle = this.c;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.R, 0, 2 * Math.PI);
                ctx.fill();
            }
            update() {

                if (this.x > W - this.R || this.x < this.R) {
                    this.dx = -dx;
                } else if (this.y > H - this.R || this.y < this.R) {
                    this.dy = -dy;
                }
            }
        }

        // Criação de array para as bolas // 
        let balls = new Array();

        function addballs() {
            // setup as many balls as wanted
            for (let i = 0; i < 4; i++) {
                let R = Math.floor(Math.random() * 256);
                let G = Math.floor(Math.random() * 256);
                let B = Math.floor(Math.random() * 256);
                let color = `rgb(${R},${G},${B})`; // random color
                let r = 40;
                // random position (inside Canvas)
                let xInit = 40 + Math.random() * (W - 2 * 40);
                let yInit = 80;

                balls.push(new Ball(xInit, yInit, r, color, 2, 4));
            }
        }
        addballs();
        // Strings do Jogo // 
        
        let hpTxt = 3;

        // Desenho inicial //

        function drawBackground() {

            // limpar canvas // 

            ctx.clearRect(0, 0, W, H);
            // criar chão //
            for (let i = 0; i < 8; i++) {
                ctx.drawImage(images['tile'], 100 * i, 430);
            }
            // criar fundo //
            ctx.drawImage(images['bg'], 10, 0, images['bg'].width, images['bg'].height, 0, 0, 1050, 470);

            // desenhar barra de status //
            
            ctx.drawImage(images['hp'],30,30,35,35);
            ctx.fillText(hpTxt,75,60);
            ctx.font = '30px fantasy';
        }
        

        // função de atualização // 

        function update() {
            if (movesRight == true) {
                ctx.drawImage(images['charR'], charX, charY)
            } else {
                ctx.drawImage(images['charL'], charX, charY)
            }

        }

        //função de renderização //
        
        function render() {

            drawBackground();
            update();
            balls.forEach(function (ball) {
                ball.draw();
                ball.update();
            });
            window.requestAnimationFrame(render);
        }
        render();

        //definição de controlos //

        document.onkeydown = function (e) {
            switch (e.key) {
                case 'ArrowLeft':
                    /*LEFT arrow*/
                    if (charX > 0) {
                        charX -= 20;
                        movesRight = false;
                    };
                    break;
                case 'ArrowRight':
                    /*RIGHT arrow*/
                    if (charX < canvas.width - 80) {
                        charX += 20;
                        movesRight = true
                    };
                    break;
            }

            e.preventDefault();
        }
    </script>
</body>

</html>
