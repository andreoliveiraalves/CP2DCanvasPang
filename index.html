<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>PANG_GAME</title>
    <style>
        canvas {
            /* Centrar canvas na página */
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
    </style>
</head>

<body>
    <canvas class="center" id="myCanvas" width="800" height="475" style="border:solid 1px black">
        Your browser does not support HTML5 Canvas.
    </canvas>
    <script>
        //obter contexto do canvas //
        const canvas = document.querySelector('#myCanvas');
        const ctx = canvas.getContext("2d");

        //definição de propriedades do canvas //
        const W = canvas.width,
            H = canvas.height;

        //Definição de coordenadas iniciais para o personagem //
        let charX = W / 2,
            charY = 305;


        //Carregando assets //
        let images = {};

        function loadImage(name) {
            images[name] = new Image();
            images[name].src = "./img/" + name + ".png";
            images[name].onload = function () {
                setInterval(1000 / 20);
            };
        }
        loadImage('bg');
        loadImage('charL');
        loadImage('charR');
        loadImage('tile');
        loadImage('hp');

        // Boleano de Controlo de direção //

        let movesRight = true;
        let lookingUp = false;

        // Construção de classe para as bolas //

        class Ball {
            constructor(x, y, r, d, c) { //construtor
                this.R = r; //radius
                this.x = x; // initial X position
                this.y = y; // initial Y position
                this.dX = 2 * Math.cos(d);
                this.dY = 2 * Math.sin(d);
                this.c = c; //cor
            }
            draw() {
                ctx.fillStyle = this.c;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.R, 0, 2 * Math.PI);
                ctx.strokeStyle = "black";
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.fill();
            }
            update() {

                if (this.x < this.R || this.x > W - this.R) {
                    this.dX = -this.dX
                }
                if (this.y < 0 + this.R || this.y > 430 - this.R) {
                    this.dY = -this.dY
                }
                this.x += this.dX;; // update horizontal position
                this.y += this.dY;; // update vertical position

            }
        }

        // Criação de array para as bolas // 



        // setup as many balls as wanted
        let b = new Array();
        for (let i = 0; i < 3; i++) {
            //random color
            let R = Math.floor(Math.random() * 256);
            let G = Math.floor(Math.random() * 256);
            let B = Math.floor(Math.random() * 256);
            let color = `rgb(${R},${G},${B})`;

            //random size
            let radius = 40;

            // random position in X
            let xInit = 600 * Math.random();
            // above Canvas in Y
            let yInit = H / 4;

            //random velocity
            let direction = Math.random() * 2 * Math.PI
            // x, y, r, v, c
            b.push(new Ball(xInit, yInit, radius, direction, color))
        }

        // Strings do Jogo // 

        let hpTxt = 3;

        // Desenho inicial //

        function drawBackground() {

            // limpar canvas // 

            ctx.clearRect(0, 0, W, H);
            // criar chão //
            for (let i = 0; i < 8; i++) {
                ctx.drawImage(images['tile'], 100 * i, 430);
            }
            // criar fundo //
            ctx.drawImage(images['bg'], 10, 0, images['bg'].width, images['bg'].height, 0, 0, 1050, 470);

            // desenhar barra de status //

            ctx.drawImage(images['hp'], 30, 30, 35, 35);
            ctx.fillStyle = "black";
            ctx.fillText(hpTxt, 75, 60);
            ctx.font = '30px fantasy';
        }


        // função de atualização // 

        function update() {
            if (movesRight == true) {
                ctx.drawImage(images['charR'], charX, charY)
            } else {
                ctx.drawImage(images['charL'], charX, charY)
            }

        }

        //função de renderização //

        function render() {


            drawBackground();
            update();
            b.forEach(function (ball) {
                ball.draw();
                ball.update();
            });
            window.requestAnimationFrame(render);
        }
        render();

        //definição de controlos //

        document.onkeydown = function (e) {
            switch (e.key) {
                case 'ArrowLeft':
                    /*LEFT arrow*/
                    if (charX > 0) {
                        charX -= 20;
                        movesRight = false;
                        lookingUp = false;
                    };
                    break;
                case 'ArrowRight':
                    /*RIGHT arrow*/
                    if (charX < canvas.width - 80) {
                        charX += 20;
                        movesRight = true
                        lookingUp = false;
                    };
                    break;
                case 'ArrowUp':
                lookingUp = true;
            }
            e.preventDefault();  
        }
        window.addEventListener("ArrowUp",onkeydown,false);
    </script>
</body>

</html>